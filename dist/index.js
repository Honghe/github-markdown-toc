(function () {
'use strict';

function appendNode(d,e){e.appendChild(d);}function insertNode(d,e,f){e.insertBefore(d,f);}function detachNode(d){d.parentNode.removeChild(d);}function teardownEach(d,e,f){for(var g=f||0;g<d.length;g+=1)d[g].teardown(e);}function createElement(d){return document.createElement(d)}function createText(d){return document.createTextNode(d)}function createComment(){return document.createComment('')}function addEventListener(d,e,f){d.addEventListener(e,f,!1);}function removeEventListener(d,e,f){d.removeEventListener(e,f,!1);}function setAttribute(d,e,f){d.setAttribute(e,f);}function get(d){return d?this._state[d]:this._state}function fire(d,e){var f=d in this._handlers&&this._handlers[d].slice();if(f)for(var g=0;g<f.length;g+=1)f[g].call(this,e);}function observe(d,e,f){var g=f&&f.defer?this._observers.pre:this._observers.post;return(g[d]||(g[d]=[])).push(e),f&&!1===f.init||(e.__calling=!0,e.call(this,this._state[d]),e.__calling=!1),{cancel:function(){var h=g[d].indexOf(e);~h&&g[d].splice(h,1);}}}function on(d,e){if('teardown'===d)return this.on('destroy',e);var f=this._handlers[d]||(this._handlers[d]=[]);return f.push(e),{cancel:function(){var g=f.indexOf(e);~g&&f.splice(g,1);}}}function set(d){this._set(d),(this._root||this)._flush();}function _flush(){if(this._renderHooks)for(;this._renderHooks.length;){var d=this._renderHooks.pop();d.fn.call(d.context);}}var proto={get:get,fire:fire,observe:observe,on:on,set:set,_flush:_flush};function dispatchObservers(d,e,f,g){for(var h in e)if(h in f){var j=f[h],k=g[h];if(j!==k||'object'==typeof j){var l=e[h];if(l)for(var n,m=0;m<l.length;m+=1)n=l[m],n.__calling||(n.__calling=!0,n.call(d,j,k),n.__calling=!1);}}}

var template=function(){return{methods:{onBtnClicked(){this.get('isEnabled')&&this.fire('toggle-nav');}}}}();function renderMainFragment(b,c){function d(){c.onBtnClicked();}var e=createElement('div');e.className='github-markdown-toc';var f=!b.isEnabled;setAttribute(e,'aria-disabled',f);var g=b.isLoading;setAttribute(e,'aria-busy',g);var h=b.isOpen;setAttribute(e,'data-open',h);var j=createElement('nav');j.id='github-markdown-toc__nav-panel';var k=!b.isOpen;setAttribute(j,'aria-hidden',k),appendNode(j,e);var l=createElement('ol');appendNode(l,j);var m=createComment();appendNode(m,l);for(var n=b.headers,o=[],p=0;p<n.length;p+=1)o[p]=renderEachBlock(b,n,n[p],p,c),o[p].mount(m.parentNode,m);appendNode(createText('\n  '),e);var q=createElement('button');q.type='button',addEventListener(q,'click',d),q.className='toggle-btn',setAttribute(q,'aria-controls','github-markdown-toc__nav-panel');var r=!b.isEnabled;return q.disabled=r,appendNode(q,e),{mount:function(s,t){insertNode(e,s,t);},update:function(s,t){var u;(u=!t.isEnabled)!=f&&(f=u,setAttribute(e,'aria-disabled',f)),(u=t.isLoading)!==g&&(g=u,setAttribute(e,'aria-busy',g)),(u=t.isOpen)!==h&&(h=u,setAttribute(e,'data-open',h)),(u=!t.isOpen)!=k&&(k=u,setAttribute(j,'aria-hidden',k));for(var v=t.headers,w=0;w<v.length;w+=1)o[w]?o[w].update(s,t,v,v[w],w):(o[w]=renderEachBlock(t,v,v[w],w,c),o[w].mount(m.parentNode,m));teardownEach(o,!0,v.length),o.length=v.length,(u=!t.isEnabled)!=r&&(r=u,q.disabled=r);},teardown:function(s){teardownEach(o,!1),removeEventListener(q,'click',d),s&&detachNode(e);}}}function renderEachBlock(b,c,d){var g=createElement('li'),h=d.level;setAttribute(g,'data-level',h);var j=createElement('a'),k=d.link;j.href=k,appendNode(j,g);var l=d.text,m=createText(l);return appendNode(m,j),{mount:function(n,o){insertNode(g,n,o);},update:function(n,o,p,q){var s;(s=q.level)!==h&&(h=s,setAttribute(g,'data-level',h)),(s=q.link)!==k&&(k=s,j.href=k),(s=q.text)!==l&&(m.data=l=s);},teardown:function(n){n&&detachNode(g);}}}function App(b){b=b||{},this._state=b.data||{},this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=b._root,this._yield=b._yield,this._torndown=!1,this._fragment=renderMainFragment(this._state,this),b.target&&this._fragment.mount(b.target,null);}App.prototype=Object.assign({},template.methods,proto),App.prototype._set=function(c){var d=this._state;this._state=Object.assign({},d,c),dispatchObservers(this,this._observers.pre,c,d),this._fragment&&this._fragment.update(c,this._state),dispatchObservers(this,this._observers.post,c,d);},App.prototype.teardown=App.prototype.destroy=function(c){this.fire('destroy'),this._fragment.teardown(!1!==c),this._fragment=null,this._state={},this._torndown=!0;};

class EventEmitter$1{constructor(){this._handlers=new Map;}on(a,b){this._handlers.has(a)||this._handlers.set(a,new Set),this._handlers.get(a).add(b);}off(a,b){return!!this._handlers.has(a)&&this._handlers.get(a).delete(b)}emit(a,b){this._handlers.has(a)&&this._handlers.get(a).forEach((c)=>c(b));}}

var index$1=function(b){return null!=b&&'object'==typeof b&&!Array.isArray(b)};

function isObjectObject(a){return!0===index$1(a)&&'[object Object]'===Object.prototype.toString.call(a)}var index=function(b){var c,d;return!1!==isObjectObject(b)&&(c=b.constructor,'function'==typeof c)&&(d=c.prototype,!1!==isObjectObject(d)&&!1!==d.hasOwnProperty('isPrototypeOf'))};

function copyObject(a){let b={};return Object.entries(a).forEach(([c,d])=>{index(d)&&(b[c]=copyObject(d));}),Object.assign({},a,b)}function deepAssign(a,...b){const c=b.map((d)=>index(d)?copyObject(d):d);return Object.assign(a,...c)}

const ON_CHANGE=Symbol('on-change');class Action{constructor(a){this._dispatcher=a;}dispatch(a,b){this._dispatcher.emit(a,b);}}class Store extends EventEmitter$1{constructor(a){super(),this._state={},this._dispatcher=a;}setState(a){this._state=deepAssign({},this._state,a),this.emit(ON_CHANGE);}getState(){return deepAssign({},this._state)}register(a,b){this._dispatcher.on(a,b);}onChange(a){this.on(ON_CHANGE,a);}removeChangeListener(a){return this.off(ON_CHANGE,a)}}const Dispatcher=EventEmitter$1;

class PageType{constructor(a){this.RELEASE=Symbol('release'),this.CODE=Symbol('code'),this.WIKI=Symbol('wiki'),this.UNKNOWN=Symbol('unknown');const{pathname:b}=new URL(a),[,c,d,e,...f]=b.split('/');this._type='releases'===e&&0===f.length?this.RELEASE:'blob'===e||'tree'===e||c&&d&&!e?this.CODE:'wiki'===e?this.WIKI:this.UNKNOWN;}isReleasePage(){return this._type===this.RELEASE}isCodePage(){return this._type===this.CODE}isWikiPage(){return this._type===this.WIKI}isUnknownPage(){return this._type===this.UNKNOWN}}

function checkJSEnebled(){return new Promise((a)=>{chrome.runtime.sendMessage({type:'is-js-enabled'},a);})}

class GitHubPage{constructor(){this.headerSelector='h1, h2, h3, h4, h5, h6',this.headers=[];}async getHeaderList(){return[]}validateHeaders(){this.headers=this.headers.filter((a)=>{return!!a.textContent.trim()});}static createFromUrl(a){const b=new PageType(a);if(b.isReleasePage())return new ReleasePage;return b.isCodePage()?new CodePage:b.isWikiPage()?new WikiPage:b.isUnknownPage()?new UnknownPage:void 0}}class ReleasePage extends GitHubPage{constructor(){super(),this.headers=Array.from(document.querySelectorAll('.release-title')),this.validateHeaders();}async getHeaderList(){return this.headers.map((a)=>{const{href:b}=a.querySelector('a'),c=a.textContent.trim();return{link:b,level:1,text:c}})}}class CodePage extends GitHubPage{constructor(){super();const a=document.querySelector('.markdown-body');this.headers=a?Array.from(a.querySelectorAll(this.headerSelector)):[],this.validateHeaders();}async getHeaderList(){const a=await checkJSEnebled();return this.headers.map((b)=>{let{id:c,href:d}=b.querySelector('.anchor');c=`#${c}`,d=new URL(d).hash;const e=a?d:c,f=+b.tagName[1],g=b.textContent.trim();return{link:e,level:f,text:g}})}}class WikiPage extends GitHubPage{constructor(){super();const a=document.querySelector('.wiki-body .markdown-body');this.headers=a?Array.from(a.querySelectorAll(this.headerSelector)):[],this.validateHeaders();}async getHeaderList(){const a=await checkJSEnebled();return this.headers.map((b)=>{let{id:c,href:d}=b.querySelector('.anchor');c=`#${c}`,d=new URL(d).hash;const e=a?d:c,f=+b.tagName[1],g=b.textContent.trim();return{link:e,level:f,text:g}})}}class UnknownPage extends GitHubPage{}

const key={START_LOADING:Symbol('start-loading'),MOVE_TO_PAGE:Symbol('move-to-page'),TOGGLE_NAV:Symbol('toggle-nav')};class AppAction extends Action{startLoading(){this.dispatch(key.START_LOADING);}async moveToPage(){const a=GitHubPage.createFromUrl(location.href),b=await a.getHeaderList(),c=!!b.length;this.dispatch(key.MOVE_TO_PAGE,{headers:b,isAvailable:c});}toggleNav(){this.dispatch(key.TOGGLE_NAV);}}

class AppStore extends Store{constructor(a){super(a),this.setState({isLoading:!1,isOpen:!1,isEnabled:!1,headers:[]}),this.register(key.START_LOADING,this.loading.bind(this)),this.register(key.MOVE_TO_PAGE,this.toPage.bind(this)),this.register(key.TOGGLE_NAV,this.toggleNav.bind(this));}loading(){this.setState({isLoading:!0});}toPage({isAvailable:a,headers:b}){this.setState({headers:b,isLoading:!1,isEnabled:a,isOpen:!!a&&this.getState().isOpen});}toggleNav(){this.setState({isOpen:!this.getState().isOpen});}}

const dispatcher=new Dispatcher; const action=new AppAction(dispatcher); const store=new AppStore(dispatcher); const dataAttr='githubMarkdownTocOpen'; const body=document.body; const rootElm=document.createElement('github-markdown-toc-container'); const app=new App({data:store.getState(),target:rootElm});body.appendChild(rootElm),store.onChange(()=>{app.set(store.getState());}),store.onChange(()=>{const{isOpen:a}=store.getState();a?body.dataset[dataAttr]='':delete body.dataset[dataAttr];}),app.on('toggle-nav',action.toggleNav.bind(action)),window.addEventListener('pjax:start',action.startLoading.bind(action)),window.addEventListener('pjax:end',action.moveToPage.bind(action)),action.moveToPage();

}());
//# sourceMappingURL=index.js.map
