!function(){'use strict';function c(){}function d(a){var b,c,d=1,e=arguments.length;for(;d<e;d++){c=arguments[d];for(b in c)a[b]=c[b]}return a}function e(a,b){b.appendChild(a)}function h(a,b,c){b.insertBefore(a,c)}function i(a){a.parentNode.removeChild(a)}function j(a,b,c){for(var d=c;d<a.length;d+=1)a[d]&&a[d].destroy(b)}function k(a){return document.createElement(a)}function l(a){return document.createTextNode(a)}function m(a,b,c){a.addEventListener(b,c,!1)}function n(a,b,c){a.removeEventListener(b,c,!1)}function o(a,b,c){a.setAttribute(b,c)}function p(a,b){return a!==b||(a&&typeof a==='object'||typeof a==='function')}function q(a,b,c,d){for(var e in b){if(!(e in c))continue;var f=c[e],g=d[e];if(p(f,g)){var h=b[e];if(!h)continue;for(var i=0;i<h.length;i+=1){var j=h[i];if(j.__calling)continue;j.__calling=!0;j.call(a,f,g);j.__calling=!1}}}}function r(a){return a?this._state[a]:this._state}function s(a,b){var c=a in this._handlers&&this._handlers[a].slice();if(!c)return;for(var d=0;d<c.length;d+=1)c[d].call(this,b)}function t(a,b,c){var d=c&&c.defer?this._observers.post:this._observers.pre;(d[a]||(d[a]=[])).push(b);(!c||c.init!==!1)&&(b.__calling=!0,b.call(this,this._state[a]),b.__calling=!1);return{cancel:function(){var c=d[a].indexOf(b);~c&&d[a].splice(c,1)}}}function u(a,b){if(a==='teardown')return this.on('destroy',b);var c=this._handlers[a]||(this._handlers[a]=[]);c.push(b);return{cancel:function(){var a=c.indexOf(b);~a&&c.splice(a,1)}}}function v(a){this._set(d({},a));this._root._flush()}function w(){if(!this._renderHooks)return;while(this._renderHooks.length)this._renderHooks.pop()()}var x={get:r,fire:s,observe:t,on:u,set:v,_flush:w},y=function(){return{methods:{onBtnClicked(){this.get('isEnabled')&&this.fire('toggle-nav')}}}}();function z(a,b){var c,d,f,g,p,q=k('div');q.className="github-markdown-toc";o(q,'aria-disabled',c=!a.isEnabled);o(q,'aria-busy',d=a.isLoading);o(q,'data-open',f=a.isOpen);var r=k('nav');e(r,q);r.id="github-markdown-toc__nav-panel";o(r,'aria-hidden',g=!a.isOpen);var s=k('ol');e(s,r);var t=a.headers,u=[];for(var v=0;v<t.length;v+=1)u[v]=A(a,t,t[v],v,b),u[v].mount(s,null);e(l("\n  "),q);var w=k('button');e(w,q);w.type="button";w.className="toggle-btn";o(w,'aria-controls',"github-markdown-toc__nav-panel");w.disabled=p=!a.isEnabled;function x(a){b.onBtnClicked()}m(w,'click',x);return{mount:function(a,b){h(q,a,b)},update:function(a,e){c!==(c=!e.isEnabled)&&o(q,'aria-disabled',c);d!==(d=e.isLoading)&&o(q,'aria-busy',d);f!==(f=e.isOpen)&&o(q,'data-open',f);g!==(g=!e.isOpen)&&o(r,'aria-hidden',g);var h=e.headers;if('headers' in a){for(var i=0;i<h.length;i+=1)u[i]?u[i].update(a,e,h,h[i],i):(u[i]=A(e,h,h[i],i,b),u[i].mount(s,null));for(;i<u.length;i+=1)u[i].unmount(),u[i].destroy();u.length=h.length}p!==(p=!e.isEnabled)&&(w.disabled=p)},unmount:function(){i(q);for(var a=0;a<u.length;a+=1)u[a].unmount()},destroy:function(){j(u,!1,0);n(w,'click',x)}}}function A(a,b,d,f,g){var j,m,n,p=k('li');o(p,'data-level',j=d.level);var q=k('a');e(q,p);q.href=m=d.link;var r=l(n=d.text);e(r,q);return{mount:function(a,b){h(p,a,b)},update:function(a,b,c,d,e){j!==(j=d.level)&&o(p,'data-level',j);m!==(m=d.link)&&(q.href=m);n!==(n=d.text)&&(r.data=n)},unmount:function(){i(p)},destroy:c}}function B(a){a=a||{};this._state=a.data||{};this._observers={pre:Object.create(null),post:Object.create(null)};this._handlers=Object.create(null);this._root=a._root||this;this._yield=a._yield;this._torndown=!1;this._fragment=z(this._state,this);a.target&&this._fragment.mount(a.target,null)}d(B.prototype,y.methods,x);B.prototype._set=function b(a){var c=this._state;this._state=d({},c,a);q(this,this._observers.pre,a,c);this._fragment.update(a,this._state);q(this,this._observers.post,a,c)};B.prototype.teardown=B.prototype.destroy=function b(a){this.fire('destroy');a!==!1&&this._fragment.unmount();this._fragment.destroy();this._fragment=null;this._state={};this._torndown=!0};class C{constructor(){this._handlers=new Map()}on(a,b){this._handlers.has(a)||this._handlers.set(a,new Set());this._handlers.get(a).add(b)}off(a,b){if(!this._handlers.has(a)){return !1}return this._handlers.get(a).delete(b)}emit(a,b){this._handlers.has(a)&&this._handlers.get(a).forEach(a=>a(b))}}function D(a){if(!a){return !1}let b=Object.getPrototypeOf(a);return Object.prototype.toString.call(a)==='[object Object]'&&(b===Object.getPrototypeOf({})||b===null)}function E(a){let b={};Object.entries(a).forEach(([a,c])=>{D(c)&&(b[a]=E(c))});return Object.assign({},a,b)}function F(a,...b){let c=b.map(a=>D(a)?E(a):a);return Object.assign(a,...c)}let G=Symbol('on-change');class H{constructor(a){this._dispatcher=a}dispatch(a,b){this._dispatcher.emit(a,b)}}class I extends C{constructor(a){super();this._state={};this._dispatcher=a}setState(a){this._state=F({},this._state,a);this.emit(G)}getState(){return F({},this._state)}register(a,b){this._dispatcher.on(a,b)}onChange(a){this.on(G,a)}removeChangeListener(a){return this.off(G,a)}}let J=C;function K(a){return function c(b){return b[a]}}function L(a){return function c(b){return b.map(a)}}function M(a){return function c(b){return b.filter(a)}}function N(a,b){return function(...c){return b(a(...c))}}function O(...a){return a.reduce(N)}function P(a){return function c(b){return a(...b)}}function Q(a){return function b(){return a}}function R(a,b,c){return{link:a,level:b,text:c}}function S(a){return function c(b){return b.querySelector(a)}}function T(a){return function c(b){return b.querySelectorAll(a)}}function U(a){return O(T(a),Array.from)}function V(a){return`#${a}`}let W=O(K('id'),V);function X(a){return a?K('hash'):W}function Y(a){return a.trim()}let Z=O(K('textContent'),Y),_=O(K('tagName'),K(1),Number),$=O(K('textContent'),Boolean),aa=M($);function ab(...a){return O(aa,...a,L(P(R)))}let ac=U('h1, h2, h3, h4, h5, h6');function ad(a,b,c,...d){return e=>[a,b,c].map(a=>a(e,...d))}class ae{constructor(a){this.RELEASE=Symbol('release');this.CODE=Symbol('code');this.WIKI=Symbol('wiki');this.UNKNOWN=Symbol('unknown');let{pathname:b}=new URL(a),[,c,d,e,...f]=b.split('/');e==='releases'&&f.length===0?(this._type=this.RELEASE):e==='blob'||e==='tree'||c&&d&&!e?(this._type=this.CODE):e==='wiki'?(this._type=this.WIKI):(this._type=this.UNKNOWN)}getType(){return this._type}isReleasePage(){return this._type===this.RELEASE}isCodePage(){return this._type===this.CODE}isWikiPage(){return this._type===this.WIKI}isUnknownPage(){return this._type===this.UNKNOWN}}function af(){return new Promise(a=>{chrome.runtime.sendMessage({type:'is-js-enabled'},a)})}class ag{constructor(){this.headers=[]}async getHeaderList(){return ab(await this.elementsToArray())(this.headers)}async elementsToArray(){return()=>[]}static createFromUrl(a){let b=new ae(a);if(b.isReleasePage())return new ah();if(b.isCodePage())return new ai();if(b.isWikiPage())return new aj();return new ak()}}class ah extends ag{constructor(){super();this.headers=U('.release-title')(document)}async elementsToArray(){return L(ad(O(S('a'),K('href')),Q(1),Z))}}class ai extends ag{constructor(){super();let a=document.querySelector('.markdown-body');this.headers=a?ac(a):this.headers}async elementsToArray(){let a=await af();return L(ad(O(S('.anchor'),X(a)),_,Z))}}class aj extends ag{constructor(){super();let a=document.querySelector('.wiki-body .markdown-body');this.headers=a?ac(a):this.headers}async elementsToArray(){let a=await af();return L(ad(O(S('.anchor'),X(a)),_,Z))}}class ak extends ag{}let al={START_LOADING:Symbol('start-loading'),MOVE_TO_PAGE:Symbol('move-to-page'),TOGGLE_NAV:Symbol('toggle-nav')};class am extends H{startLoading(){this.dispatch(al.START_LOADING)}async moveToPage(){let a=ag.createFromUrl(location.href),b=await a.getHeaderList(),c=Boolean(b.length),d={headers:b,isAvailable:c};this.dispatch(al.MOVE_TO_PAGE,d)}toggleNav(){this.dispatch(al.TOGGLE_NAV)}}class an extends I{constructor(a){super(a);this.setState({isLoading:!1,isOpen:!1,isEnabled:!1,headers:[]});this.register(al.START_LOADING,this.loading.bind(this));this.register(al.MOVE_TO_PAGE,this.toPage.bind(this));this.register(al.TOGGLE_NAV,this.toggleNav.bind(this))}loading(){this.setState({isLoading:!0})}toPage({isAvailable:a,headers:b}){this.setState({headers:b,isLoading:!1,isEnabled:a,isOpen:a?this.getState().isOpen:!1})}toggleNav(){this.setState({isOpen:!this.getState().isOpen})}}let ao=new J(),ap=new am(ao),aq=new an(ao),ar='githubMarkdownTocOpen',as=document.body,at=document.createElement('github-markdown-toc-container'),au=new B({data:aq.getState(),target:at});as.appendChild(at);aq.onChange(()=>{au.set(aq.getState())});aq.onChange(()=>{let{isOpen:a}=aq.getState();a?(as.dataset[ar]=''):delete as.dataset[ar]});au.on('toggle-nav',ap.toggleNav.bind(ap));window.addEventListener('pjax:start',ap.startLoading.bind(ap));window.addEventListener('pjax:end',ap.moveToPage.bind(ap));ap.moveToPage()}()
//# sourceMappingURL=index.js.map
