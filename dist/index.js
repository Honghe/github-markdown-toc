(function () {
'use strict';

function appendNode(a,b){b.appendChild(a);}function insertNode(a,b,d){b.insertBefore(a,d);}function detachNode(a){a.parentNode.removeChild(a);}function teardownEach(a,b,d){for(var e=d||0;e<a.length;e+=1)a[e].teardown(b);}function createElement(a){return document.createElement(a)}function createText(a){return document.createTextNode(a)}function createComment(){return document.createComment('')}function addEventListener(a,b,d){a.addEventListener(b,d,!1);}function removeEventListener(a,b,d){a.removeEventListener(b,d,!1);}function setAttribute(a,b,d){a.setAttribute(b,d);}function get(a){return a?this._state[a]:this._state}function fire(a,b){var d=a in this._handlers&&this._handlers[a].slice();if(d)for(var e=0;e<d.length;e+=1)d[e].call(this,b);}function observe(a,b,d){var e=d&&d.defer?this._observers.pre:this._observers.post;return(e[a]||(e[a]=[])).push(b),d&&!1===d.init||(b.__calling=!0,b.call(this,this._state[a]),b.__calling=!1),{cancel:function(){var f=e[a].indexOf(b);~f&&e[a].splice(f,1);}}}function on(a,b){if('teardown'===a)return this.on('destroy',b);var d=this._handlers[a]||(this._handlers[a]=[]);return d.push(b),{cancel:function(){var e=d.indexOf(b);~e&&d.splice(e,1);}}}function set(a){this._set(a),(this._root||this)._flush();}function _flush(){if(this._renderHooks)for(;this._renderHooks.length;){var a=this._renderHooks.pop();a.fn.call(a.context);}}var proto={get:get,fire:fire,observe:observe,on:on,set:set,_flush:_flush};function dispatchObservers(a,b,d,e){for(var f in b)if(f in d){var g=d[f],h=e[f];if(g!==h||'object'==typeof g){var j=b[f];if(j)for(var l,k=0;k<j.length;k+=1)l=j[k],l.__calling||(l.__calling=!0,l.call(a,g,h),l.__calling=!1);}}}

var template=function(){return{methods:{onBtnClicked(){this.get('isEnabled')&&this.fire('toggle-nav');}}}}();function renderMainFragment(b,c){function d(){c.onBtnClicked();}var e=createElement('div');e.className='github-markdown-toc';var f=!b.isEnabled;setAttribute(e,'aria-disabled',f);var g=b.isLoading;setAttribute(e,'aria-busy',g);var h=b.isOpen;setAttribute(e,'data-open',h);var j=createElement('nav');j.id='github-markdown-toc__nav-panel';var k=!b.isOpen;setAttribute(j,'aria-hidden',k),appendNode(j,e);var l=createElement('ol');appendNode(l,j);var m=createComment();appendNode(m,l);for(var n=b.headers,o=[],p=0;p<n.length;p+=1)o[p]=renderEachBlock(b,n,n[p],p,c),o[p].mount(m.parentNode,m);appendNode(createText('\n  '),e);var q=createElement('button');q.type='button',addEventListener(q,'click',d),q.className='toggle-btn',setAttribute(q,'aria-controls','github-markdown-toc__nav-panel');var r=!b.isEnabled;return q.disabled=r,appendNode(q,e),{mount:function(s,t){insertNode(e,s,t);},update:function(s,t){var u;(u=!t.isEnabled)!=f&&(f=u,setAttribute(e,'aria-disabled',f)),(u=t.isLoading)!==g&&(g=u,setAttribute(e,'aria-busy',g)),(u=t.isOpen)!==h&&(h=u,setAttribute(e,'data-open',h)),(u=!t.isOpen)!=k&&(k=u,setAttribute(j,'aria-hidden',k));for(var v=t.headers,w=0;w<v.length;w+=1)o[w]?o[w].update(s,t,v,v[w],w):(o[w]=renderEachBlock(t,v,v[w],w,c),o[w].mount(m.parentNode,m));teardownEach(o,!0,v.length),o.length=v.length,(u=!t.isEnabled)!=r&&(r=u,q.disabled=r);},teardown:function(s){teardownEach(o,!1),removeEventListener(q,'click',d),s&&detachNode(e);}}}function renderEachBlock(b,c,d){var g=createElement('li'),h=d.level;setAttribute(g,'data-level',h);var j=createElement('a'),k=d.link;j.href=k,appendNode(j,g);var l=d.text,m=createText(l);return appendNode(m,j),{mount:function(n,o){insertNode(g,n,o);},update:function(n,o,p,q){var s;(s=q.level)!==h&&(h=s,setAttribute(g,'data-level',h)),(s=q.link)!==k&&(k=s,j.href=k),(s=q.text)!==l&&(m.data=l=s);},teardown:function(n){n&&detachNode(g);}}}function App(b){b=b||{},this._state=b.data||{},this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=b._root,this._yield=b._yield,this._torndown=!1,this._fragment=renderMainFragment(this._state,this),b.target&&this._fragment.mount(b.target,null);}App.prototype=Object.assign({},template.methods,proto),App.prototype._set=function(c){var d=this._state;this._state=Object.assign({},d,c),dispatchObservers(this,this._observers.pre,c,d),this._fragment&&this._fragment.update(c,this._state),dispatchObservers(this,this._observers.post,c,d);},App.prototype.teardown=App.prototype.destroy=function(c){this.fire('destroy'),this._fragment.teardown(!1!==c),this._fragment=null,this._state={},this._torndown=!0;};

class EventEmitter$1{constructor(){this._handlers=new Map;}on(a,b){this._handlers.has(a)||this._handlers.set(a,new Set),this._handlers.get(a).add(b);}off(a,b){return!!this._handlers.has(a)&&this._handlers.get(a).delete(b)}emit(a,b){this._handlers.has(a)&&this._handlers.get(a).forEach((c)=>c(b));}}

var index$1=function(b){return null!=b&&'object'==typeof b&&!Array.isArray(b)};

function isObjectObject(a){return!0===index$1(a)&&'[object Object]'===Object.prototype.toString.call(a)}var index=function(b){var c,d;return!1!==isObjectObject(b)&&(c=b.constructor,'function'==typeof c)&&(d=c.prototype,!1!==isObjectObject(d)&&!1!==d.hasOwnProperty('isPrototypeOf'))};

function copyObject(a){let b={};return Object.entries(a).forEach(([c,d])=>{index(d)&&(b[c]=copyObject(d));}),Object.assign({},a,b)}function deepAssign(a,...b){const c=b.map((d)=>index(d)?copyObject(d):d);return Object.assign(a,...c)}

const ON_CHANGE=Symbol('on-change');class Action{constructor(a){this._dispatcher=a;}dispatch(a,b){this._dispatcher.emit(a,b);}}class Store extends EventEmitter$1{constructor(a){super(),this._state={},this._dispatcher=a;}setState(a){this._state=deepAssign({},this._state,a),this.emit(ON_CHANGE);}getState(){return deepAssign({},this._state)}register(a,b){this._dispatcher.on(a,b);}onChange(a){this.on(ON_CHANGE,a);}removeChangeListener(a){return this.off(ON_CHANGE,a)}}const Dispatcher=EventEmitter$1;

function checkJSEnebled(){return new Promise((a)=>{chrome.runtime.sendMessage({type:'is-js-enabled'},a);})}

class PageType{constructor(a){this.RELEASE=Symbol('release'),this.CODE=Symbol('code'),this.WIKI=Symbol('wiki'),this.UNKNOWN=Symbol('unknown');const{pathname:b}=new URL(a),[,c,d,e,...f]=b.split('/');this._type='releases'===e&&0===f.length?this.RELEASE:'blob'===e||'tree'===e||c&&d&&!e?this.CODE:'wiki'===e?this.WIKI:this.UNKNOWN;}isReleasePage(){return this._type===this.RELEASE}isCodePage(){return this._type===this.CODE}isWikiPage(){return this._type===this.WIKI}isUnknownPage(){return this._type===this.UNKNOWN}}

const headerSelector='h1, h2, h3, h4, h5, h6';function fetchReleaseHeader(){const a=document.querySelectorAll('.release-title');return getHeaderDataFromReleaseDOM(a)}async function fetchMarkdownHeader(){const a=document.querySelector('.markdown-body');if(!a)return[];const b=a.querySelectorAll(headerSelector);return await getHeaderDataFromMarkdownDOM(b)}async function fetchWikiHeader(){const a=document.querySelector('.wiki-body .markdown-body');if(!a)return[];const b=a.querySelectorAll(headerSelector);return await getHeaderDataFromMarkdownDOM(b)}function getHeaderDataFromReleaseDOM(a){let b=Array.from(a);return b=validateHeaders(b),b.map((c)=>{const{href:d}=c.querySelector('a'),e=c.textContent.trim();return{link:d,level:1,text:e}})}async function getHeaderDataFromMarkdownDOM(a){const b=await checkJSEnebled();let c=Array.from(a);return c=validateHeaders(c),c.map((d)=>{let{id:e,href:f}=d.querySelector('.anchor');e=`#${e}`,f=new URL(f).hash;const g=b?f:e,i=+d.tagName[1],j=d.textContent.trim();return{link:g,level:i,text:j}})}function validateHeaders(a){return a.filter((b)=>{return!!b.textContent.trim()})}var fetchHeader = (async function(){const b=new PageType(location.href);return b.isReleasePage()?fetchReleaseHeader():b.isCodePage()?await fetchMarkdownHeader():b.isWikiPage()?await fetchWikiHeader():[]});

const key={START_LOADING:Symbol('start-loading'),MOVE_TO_PAGE:Symbol('move-to-page'),TOGGLE_NAV:Symbol('toggle-nav')};class AppAction extends Action{startLoading(){this.dispatch(key.START_LOADING);}async moveToPage(){const a=await fetchHeader(),b=!!a.length;this.dispatch(key.MOVE_TO_PAGE,{headers:a,isAvailable:b});}toggleNav(){this.dispatch(key.TOGGLE_NAV);}}

class AppStore extends Store{constructor(a){super(a),this.setState({isLoading:!1,isOpen:!1,isEnabled:!1,headers:[]}),this.register(key.START_LOADING,this.loading.bind(this)),this.register(key.MOVE_TO_PAGE,this.toPage.bind(this)),this.register(key.TOGGLE_NAV,this.toggleNav.bind(this));}loading(){this.setState({isLoading:!0});}toPage({isAvailable:a,headers:b}){this.setState({headers:b,isLoading:!1,isEnabled:a,isOpen:!!a&&this.getState().isOpen});}toggleNav(){this.setState({isOpen:!this.getState().isOpen});}}

const dispatcher=new Dispatcher; const action=new AppAction(dispatcher); const store=new AppStore(dispatcher); const dataAttr='githubMarkdownTocOpen'; const body=document.body; const rootElm=document.createElement('github-markdown-toc-container'); const app=new App({data:store.getState(),target:rootElm});body.appendChild(rootElm),store.onChange(()=>{app.set(store.getState());}),store.onChange(()=>{const{isOpen:a}=store.getState();a?body.dataset[dataAttr]='':delete body.dataset[dataAttr];}),app.on('toggle-nav',action.toggleNav.bind(action)),window.addEventListener('pjax:start',action.startLoading.bind(action)),window.addEventListener('pjax:end',action.moveToPage.bind(action)),action.moveToPage();

}());
//# sourceMappingURL=index.js.map
