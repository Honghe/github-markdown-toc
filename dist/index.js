(function () {
'use strict';

function appendNode(d,e){e.appendChild(d);}function insertNode(d,e,f){e.insertBefore(d,f);}function detachNode(d){d.parentNode.removeChild(d);}function destroyEach(d,e,f){for(var g=f;g<d.length;g+=1)d[g].destroy(e);}function createElement(d){return document.createElement(d)}function createText(d){return document.createTextNode(d)}function createComment(){return document.createComment('')}function addEventListener(d,e,f){d.addEventListener(e,f,!1);}function removeEventListener(d,e,f){d.removeEventListener(e,f,!1);}function setAttribute(d,e,f){d.setAttribute(e,f);}function assign(d){for(var f,e=1;e<arguments.length;e+=1)for(var g in f=arguments[e],f)d[g]=f[g];return d}function differs(d,e){return d!==e||d&&'object'==typeof d||'function'==typeof d}function dispatchObservers(d,e,f,g){for(var h in e)if(h in f){var j=f[h],l=g[h];if(differs(j,l)){var m=e[h];if(!m)continue;for(var o,n=0;n<m.length;n+=1)o=m[n],o.__calling||(o.__calling=!0,o.call(d,j,l),o.__calling=!1);}}}function get(d){return d?this._state[d]:this._state}function fire(d,e){var f=d in this._handlers&&this._handlers[d].slice();if(f)for(var g=0;g<f.length;g+=1)f[g].call(this,e);}function observe(d,e,f){var g=f&&f.defer?this._observers.post:this._observers.pre;return(g[d]||(g[d]=[])).push(e),f&&!1===f.init||(e.__calling=!0,e.call(this,this._state[d]),e.__calling=!1),{cancel:function(){var h=g[d].indexOf(e);~h&&g[d].splice(h,1);}}}function on(d,e){if('teardown'===d)return this.on('destroy',e);var f=this._handlers[d]||(this._handlers[d]=[]);return f.push(e),{cancel:function(){var g=f.indexOf(e);~g&&f.splice(g,1);}}}function set(d){this._set(assign({},d)),(this._root||this)._flush();}function _flush(){if(this._renderHooks)for(;this._renderHooks.length;){var d=this._renderHooks.pop();d.fn.call(d.context);}}var proto={get:get,fire:fire,observe:observe,on:on,set:set,_flush:_flush};

var template=function(){return{methods:{onBtnClicked(){this.get('isEnabled')&&this.fire('toggle-nav');}}}}();function create_main_fragment(b,c){function d(){c.onBtnClicked();}var e,f,g,h,j,k=createElement('div');k.className='github-markdown-toc',setAttribute(k,'aria-disabled',e=!b.isEnabled),setAttribute(k,'aria-busy',f=b.isLoading),setAttribute(k,'data-open',g=b.isOpen);var l=createElement('nav');appendNode(l,k),l.id='github-markdown-toc__nav-panel',setAttribute(l,'aria-hidden',h=!b.isOpen);var m=createElement('ol');appendNode(m,l);var n=createComment();appendNode(n,m);for(var o=b.headers,p=[],q=0;q<o.length;q+=1)p[q]=create_each_block(b,o,o[q],q,c),p[q].mount(m,n);appendNode(createText('\n  '),k);var r=createElement('button');return appendNode(r,k),r.type='button',r.className='toggle-btn',setAttribute(r,'aria-controls','github-markdown-toc__nav-panel'),r.disabled=j=!b.isEnabled,addEventListener(r,'click',d),{mount:function(s,t){insertNode(k,s,t);},update:function(s,t){e!==(e=!t.isEnabled)&&setAttribute(k,'aria-disabled',e),f!==(f=t.isLoading)&&setAttribute(k,'aria-busy',f),g!==(g=t.isOpen)&&setAttribute(k,'data-open',g),h!==(h=!t.isOpen)&&setAttribute(l,'aria-hidden',h);var u=t.headers;if('headers'in s){for(var v=0;v<u.length;v+=1)p[v]?p[v].update(s,t,u,u[v],v):(p[v]=create_each_block(t,u,u[v],v,c),p[v].mount(n.parentNode,n));destroyEach(p,!0,u.length),p.length=u.length;}j!==(j=!t.isEnabled)&&(r.disabled=j);},destroy:function(s){destroyEach(p,!1,0),removeEventListener(r,'click',d),s&&detachNode(k);}}}function create_each_block(b,c,d){var g,h,j,k=createElement('li');setAttribute(k,'data-level',g=d.level);var l=createElement('a');appendNode(l,k),l.href=h=d.link;var m=createText(j=d.text);return appendNode(m,l),{mount:function(n,o){insertNode(k,n,o);},update:function(n,o,p,q){g!==(g=q.level)&&setAttribute(k,'data-level',g),h!==(h=q.link)&&(l.href=h),j!==(j=q.text)&&(m.data=j);},destroy:function(n){n&&detachNode(k);}}}function App(b){b=b||{},this._state=b.data||{},this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=b._root,this._yield=b._yield,this._torndown=!1,this._fragment=create_main_fragment(this._state,this),b.target&&this._fragment.mount(b.target,null);}assign(App.prototype,template.methods,proto),App.prototype._set=function(c){var d=this._state;this._state=assign({},d,c),dispatchObservers(this,this._observers.pre,c,d),this._fragment&&this._fragment.update(c,this._state),dispatchObservers(this,this._observers.post,c,d);},App.prototype.teardown=App.prototype.destroy=function(c){this.fire('destroy'),this._fragment.destroy(!1!==c),this._fragment=null,this._state={},this._torndown=!0;};

class EventEmitter$1{constructor(){this._handlers=new Map;}on(a,b){this._handlers.has(a)||this._handlers.set(a,new Set),this._handlers.get(a).add(b);}off(a,b){return!!this._handlers.has(a)&&this._handlers.get(a).delete(b)}emit(a,b){this._handlers.has(a)&&this._handlers.get(a).forEach((c)=>c(b));}}

function isPlainObject(a){if(!a)return!1;const b=Object.getPrototypeOf(a);return'[object Object]'===Object.prototype.toString.call(a)&&(b===Object.getPrototypeOf({})||null===b)}

function copyObject(a){let b={};return Object.entries(a).forEach(([c,d])=>{isPlainObject(d)&&(b[c]=copyObject(d));}),Object.assign({},a,b)}function deepAssign(a,...b){const c=b.map((d)=>isPlainObject(d)?copyObject(d):d);return Object.assign(a,...c)}

const ON_CHANGE=Symbol('on-change');class Action{constructor(a){this._dispatcher=a;}dispatch(a,b){this._dispatcher.emit(a,b);}}class Store extends EventEmitter$1{constructor(a){super(),this._state={},this._dispatcher=a;}setState(a){this._state=deepAssign({},this._state,a),this.emit(ON_CHANGE);}getState(){return deepAssign({},this._state)}register(a,b){this._dispatcher.on(a,b);}onChange(a){this.on(ON_CHANGE,a);}removeChangeListener(a){return this.off(ON_CHANGE,a)}}const Dispatcher=EventEmitter$1;

class PageType{constructor(a){this.RELEASE=Symbol('release'),this.CODE=Symbol('code'),this.WIKI=Symbol('wiki'),this.UNKNOWN=Symbol('unknown');const{pathname:b}=new URL(a),[,c,d,e,...f]=b.split('/');this._type='releases'===e&&0===f.length?this.RELEASE:'blob'===e||'tree'===e||c&&d&&!e?this.CODE:'wiki'===e?this.WIKI:this.UNKNOWN;}getType(){return this._type}isReleasePage(){return this._type===this.RELEASE}isCodePage(){return this._type===this.CODE}isWikiPage(){return this._type===this.WIKI}isUnknownPage(){return this._type===this.UNKNOWN}}

function checkJSEnebled(){return new Promise((a)=>{chrome.runtime.sendMessage({type:'is-js-enabled'},a);})}

class GitHubPage{constructor(){this._headerSelector='h1, h2, h3, h4, h5, h6',this.headers=[];}async getHeaderList(){return[]}_validateHeaders(){this.headers=this.headers.filter((a)=>{return!!a.textContent.trim()});}static createFromUrl(a){const b=new PageType(a);return b.isReleasePage()?new ReleasePage:b.isCodePage()?new CodePage:b.isWikiPage()?new WikiPage:new UnknownPage}}class ReleasePage extends GitHubPage{constructor(){super(),this.headers=Array.from(document.querySelectorAll('.release-title')),this._validateHeaders();}async getHeaderList(){return this.headers.map((a)=>{const{href:b}=a.querySelector('a'),c=a.textContent.trim();return{link:b,level:1,text:c}})}}class CodePage extends GitHubPage{constructor(){super();const a=document.querySelector('.markdown-body');a&&(this.headers=Array.from(a.querySelectorAll(this._headerSelector))),this._validateHeaders();}async getHeaderList(){const a=await checkJSEnebled();return this.headers.map((b)=>{let{id:c,href:d}=b.querySelector('.anchor');c=`#${c}`,d=new URL(d).hash;const e=a?d:c,f=+b.tagName[1],g=b.textContent.trim();return{link:e,level:f,text:g}})}}class WikiPage extends GitHubPage{constructor(){super();const a=document.querySelector('.wiki-body .markdown-body');a&&(this.headers=Array.from(a.querySelectorAll(this._headerSelector))),this._validateHeaders();}async getHeaderList(){const a=await checkJSEnebled();return this.headers.map((b)=>{let{id:c,href:d}=b.querySelector('.anchor');c=`#${c}`,d=new URL(d).hash;const e=a?d:c,f=+b.tagName[1],g=b.textContent.trim();return{link:e,level:f,text:g}})}}class UnknownPage extends GitHubPage{}

const key={START_LOADING:Symbol('start-loading'),MOVE_TO_PAGE:Symbol('move-to-page'),TOGGLE_NAV:Symbol('toggle-nav')};class AppAction extends Action{startLoading(){this.dispatch(key.START_LOADING);}async moveToPage(){const a=GitHubPage.createFromUrl(location.href),b=await a.getHeaderList(),c=!!b.length;this.dispatch(key.MOVE_TO_PAGE,{headers:b,isAvailable:c});}toggleNav(){this.dispatch(key.TOGGLE_NAV);}}

class AppStore extends Store{constructor(a){super(a),this.setState({isLoading:!1,isOpen:!1,isEnabled:!1,headers:[]}),this.register(key.START_LOADING,this.loading.bind(this)),this.register(key.MOVE_TO_PAGE,this.toPage.bind(this)),this.register(key.TOGGLE_NAV,this.toggleNav.bind(this));}loading(){this.setState({isLoading:!0});}toPage({isAvailable:a,headers:b}){this.setState({headers:b,isLoading:!1,isEnabled:a,isOpen:!!a&&this.getState().isOpen});}toggleNav(){this.setState({isOpen:!this.getState().isOpen});}}

const dispatcher=new Dispatcher; const action=new AppAction(dispatcher); const store=new AppStore(dispatcher); const dataAttr='githubMarkdownTocOpen'; const body=document.body; const rootElm=document.createElement('github-markdown-toc-container'); const app=new App({data:store.getState(),target:rootElm});body.appendChild(rootElm),store.onChange(()=>{app.set(store.getState());}),store.onChange(()=>{const{isOpen:a}=store.getState();a?body.dataset[dataAttr]='':delete body.dataset[dataAttr];}),app.on('toggle-nav',action.toggleNav.bind(action)),window.addEventListener('pjax:start',action.startLoading.bind(action)),window.addEventListener('pjax:end',action.moveToPage.bind(action)),action.moveToPage();

}());
//# sourceMappingURL=index.js.map
