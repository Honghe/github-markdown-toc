{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/is-plain-object/index.js","node_modules/isobject/index.js","node_modules/tiny-emitter/index.js","src/action-type.js","src/action.js","src\\SvelteComponent.html","src/check-js-enabled.js","src/check-page-type.js","src/deep-asign.js","src/get-header-data.js","src/index.js","src/store.js"],"names":[],"mappings":"AAAA,wcCAA,AACA,AACA,AACA,AACA,AACA,AACA,CACA,AACA,aAGA,aACA,cACA,IACA,qDACA,CANA,QACA,YAMA,qBACA,OACA,AACA,eACA,AACA,AACA,SACA,YACA,AACA,AACA,4BACA,iBACA,AACA,AACA,0BACA,AACA,AACA,AACA,AACA,AACA,iBACA,iCCrCA,AACA,AACA,AACA,AACA,AACA,AACA,CACA,AACA,aACA,qBACA,iBACA,mCACA,EACA,wBCbA,YACA,AACA,AACA,CACA,CACA,YACA,mBACA,qBACA,AACA,mCACA,IACA,MACA,AACA,AACA,IACA,IACA,AACA,sBACA,aAEA,SACA,aACA,UACA,AACA,OALA,gBAMA,cACA,EACA,AACA,kBACA,+BACA,oCACA,UACA,MACA,AACA,iBACA,2BACA,AACA,AACA,SACA,KACA,AACA,mBACA,qBACA,UACA,GACA,AACA,WACA,6BACA,6BACA,YACA,AACA,AACA,AACA,AACA,AACA,AACA,AACA,aACA,YACA,WACA,AACA,GACA,IACA,AACA,GACA,UACA,wBClEA,UACA,sBACA,qCACA,kCACA,AACA,qCCLA,UACA,8CACA,wBACA,CACA,qBACA,sBACA,qBACA,wBAgCA,EACA,QAhCA,KACA,eACA,iBACA,CACA,eACA,wBACA,cACA,mBACA,IACA,sBACA,cACA,QACA,UACA,UACA,WACA,UACA,AACA,AACA,AACA,oBACA,SACA,CACA,UACA,AACA,mDACA,EACA,YACA,wBACA,WACA,AACA,4IC9BkC,AAAY,AAAE,sEARG,GAAC,AAAS,yCAAmB,AAAS,qCAAmB,AAAM,qFACvD,GAAC,AAAM,qFAEpD,AAAO,sOAK4G,GAAC,AAAS,kGARxF,GAAC,AAAS,iDAAmB,AAAS,8CAAmB,AAAM,yCACvD,GAAC,AAAM,mDAEpD,AAAO,mJAK4G,GAAC,AAAS,2HAJrH,EAAU,iCAAiB,EAAW,2BAAQ,AAAM,EAAC,AAAI,2FAAzD,EAAU,iCAAiB,EAAW,6BAAQ,AAAM,EAAC,AAAI,0/BAMvE,CACN,MAAe,CACb,AAAO,QAAE,CACP,AAAY,AAAC,cAAG,AACd,CAAI,AAAI,KAAC,AAAG,IAAC,AAAW,AAAC,AAAE,cACzB,AAAI,KAAC,AAAI,KAAC,AAAY,AAAC,AACxB,aACF,AACF,AACF,AACH,muCCZA,EACA,QATA,UACA,yBACA,4BACA,MACA,iBACA,EACA,EACA,wBCPA,QACA,gBACA,uBACA,oBACA,uBACA,AACA,YAcA,iBACA,cAdA,WACA,2BACA,uBACA,2BACA,sBACA,qDACA,SACA,KACA,gBACA,AACA,OACA,OACA,yBCjBA,aACA,IACA,eACA,gCACA,KACA,eACA,AACA,IACA,AACA,sBACA,EACA,CAbA,UACA,mBAkBA,EACA,QANA,gBACA,sBACA,8BACA,EACA,4CCwBA,mBACA,cACA,qCACA,qBACA,kCACA,kBACA,gBACA,iBACA,0BACA,sBACA,aACA,CACA,OACA,MACA,AACA,OACA,EACA,CA3DA,UACA,2BACA,yBA0DA,UACA,CACA,mBA3DA,UACA,mCACA,wBACA,AACA,AACA,0BACA,+BACA,AACA,qBAEA,aACA,CACA,OACA,IAJA,MAKA,AACA,OACA,KACA,EA2CA,oBA1CA,gBACA,gCACA,sBACA,EACA,AACA,oCACA,kBACA,EACA,EAmCA,AACA,gBAnCA,gBACA,gCACA,iCACA,EACA,AACA,kCACA,sCACA,uBACA,MACA,WACA,EACA,iDCzCA,AACA,aACA,UACA,kBACA,oBACA,mBACA,AACA,mBACA,WACA,WACA,KACA,mCACA,AACA,8BACA,yCACA,QACA,kBACA,IACA,iBACA,eACA,SACA,cACA,eACA,mBACA,WACA,eACA,AACA,oBACA,AACA,KACA,uCACA,6DACA,qDACA,IACA,EACA,mGCnCA,UACA,oBACA,uBACA,6BACA,aA6CA,EACA,QA7CA,eACA,eACA,CACA,wBACA,aACA,CACA,aACA,UACA,aACA,AACA,iEACA,0DACA,2DACA,MACA,UACA,eACA,CACA,AACA,cACA,kCACA,eACA,CACA,UACA,uBACA,yBACA,AACA,QACA,YACA,eACA,oBACA,AACA,QACA,YACA,4BACA,aACA,EACA,YACA,WACA,EACA,WACA,kBACA,MACA,AACA","file":"generated.js","sourceRoot":"","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nvar isObject = require('isobject');\n\nfunction isObjectObject(o) {\n  return isObject(o) === true\n    && Object.prototype.toString.call(o) === '[object Object]';\n}\n\nmodule.exports = function isPlainObject(o) {\n  var ctor,prot;\n  \n  if (isObjectObject(o) === false) return false;\n  \n  // If has modified constructor\n  ctor = o.constructor;\n  if (typeof ctor !== 'function') return false;\n  \n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObjectObject(prot) === false) return false;\n  \n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n  \n  // Most likely a plain Object\n  return true;\n};\n","/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object'\n    && !Array.isArray(val);\n};\n","function E () {\n  // Keep this empty so it's easier to inherit from\n  // (via https://github.com/lipsmack from https://github.com/scottcorgan/tiny-emitter/issues/3)\n}\n\nE.prototype = {\n  on: function (name, callback, ctx) {\n    var e = this.e || (this.e = {});\n\n    (e[name] || (e[name] = [])).push({\n      fn: callback,\n      ctx: ctx\n    });\n\n    return this;\n  },\n\n  once: function (name, callback, ctx) {\n    var self = this;\n    function listener () {\n      self.off(name, listener);\n      callback.apply(ctx, arguments);\n    };\n\n    listener._ = callback\n    return this.on(name, listener, ctx);\n  },\n\n  emit: function (name) {\n    var data = [].slice.call(arguments, 1);\n    var evtArr = ((this.e || (this.e = {}))[name] || []).slice();\n    var i = 0;\n    var len = evtArr.length;\n\n    for (i; i < len; i++) {\n      evtArr[i].fn.apply(evtArr[i].ctx, data);\n    }\n\n    return this;\n  },\n\n  off: function (name, callback) {\n    var e = this.e || (this.e = {});\n    var evts = e[name];\n    var liveEvents = [];\n\n    if (evts && callback) {\n      for (var i = 0, len = evts.length; i < len; i++) {\n        if (evts[i].fn !== callback && evts[i].fn._ !== callback)\n          liveEvents.push(evts[i]);\n      }\n    }\n\n    // Remove event from queue to prevent memory leak\n    // Suggested by https://github.com/lazd\n    // Ref: https://github.com/scottcorgan/tiny-emitter/commit/c6ebfaa9bc973b33d110a84a307742b7cf94c953#commitcomment-5024910\n\n    (liveEvents.length)\n      ? e[name] = liveEvents\n      : delete e[name];\n\n    return this;\n  }\n};\n\nmodule.exports = E;\n","module.exports = {\r\n  START_LOADING: Symbol('start-loading'),\r\n  MOVE_TO_PAGE: Symbol('move-to-page'),\r\n  TOGGLE_NAV: Symbol('toggle-nav')\r\n}\r\n","const key = require('./action-type.js')\nconst { key: pageKey, checkPageType } = require('./check-page-type.js')\nconst {\n  fetchReleaseHeader,\n  fetchMarkdownHeader,\n  fetchWikiHeader\n} = require('./get-header-data.js')\n\nclass AppAction {\n  constructor (dispatcher) {\n    this.dispatcher = dispatcher\n  }\n  startLoading () {\n    this.dispatcher.emit(key.START_LOADING)\n  }\n  async moveToPage () {\n    let headers\n    const type = checkPageType(location.href)\n    if (type === pageKey.RELEASE) {\n      headers = fetchReleaseHeader()\n    } else if (type === pageKey.CODE) {\n      headers = await fetchMarkdownHeader()\n    } else if (type === pageKey.WIKI) {\n      headers = await fetchWikiHeader()\n    } else {\n      headers = []\n    }\n    const isAvailable = Boolean(headers.length)\n    const data = {\n      headers,\n      isAvailable\n    }\n    this.dispatcher.emit(key.MOVE_TO_PAGE, data)\n  }\n  toggleNav () {\n    this.dispatcher.emit(key.TOGGLE_NAV)\n  }\n}\n\nmodule.exports = AppAction\n","<div class=\"github-markdown-toc\" aria-disabled=\"{{ !isEnabled }}\" aria-busy=\"{{ isLoading }}\" data-open=\"{{ isOpen }}\">\n  <nav id=\"github-markdown-toc__nav-panel\" aria-hidden=\"{{ !isOpen }}\">\n    <ol>\n      {{#each headers as header}}\n        <li class=\"{{ header.tag }}\"><a href=\"{{ header.link }}\">{{ header.text }}</a></li>\n      {{/each}}\n    </ol>\n  </nav>\n  <button type=\"button\" on:click=\"onBtnClicked()\" class=\"toggle-btn\" aria-controls=\"github-markdown-toc__nav-panel\" disabled=\"{{ !isEnabled }}\"></button>\n</div>\n<script>\n  export default {\n    methods: {\n      onBtnClicked () {\n        if (this.get('isEnabled')) {\n          this.fire('toggle-nav')\n        }\n      }\n    }\n  }\n</script>\n","function checkJSEnebled () {\r\n  return new Promise(resolve => {\r\n    chrome.runtime.sendMessage({\r\n      type: 'is-js-enabled'\r\n    }, resolve)\r\n  })\r\n}\r\n\r\nmodule.exports = checkJSEnebled\r\n","const key = {\r\n  RELEASE: Symbol('release'),\r\n  CODE: Symbol('code'),\r\n  WIKI: Symbol('wiki'),\r\n  UNKNOWN: Symbol('unknown')\r\n}\r\n\r\nfunction checkPageType (url) {\r\n  const { pathname: path } = new URL(url)\r\n  const [, user, project, ...pathes] = path.split('/')\r\n  if (pathes[0] === 'releases' && pathes.length === 1) {\r\n    return key.RELEASE\r\n  } else if (pathes[0] === 'blob' || pathes[0] === 'tree' || (user && project && !pathes.length)) {\r\n    return key.CODE\r\n  } else if (pathes[0] === 'wiki') {\r\n    return key.WIKI\r\n  }\r\n  return key.UNKNOWN\r\n}\r\n\r\nmodule.exports = { key, checkPageType }\r\n","const isPlainObject = require('is-plain-object')\r\n\r\nfunction copyObject (obj) {\r\n  let copy = {}\r\n  if (isPlainObject(obj)) {\r\n    Object.keys(obj).forEach(k => {\r\n      if (isPlainObject(obj[k])) {\r\n        copy[k] = copyObject(obj[k])\r\n      }\r\n    })\r\n  }\r\n  return Object.assign({}, obj, copy)\r\n}\r\n\r\nfunction deepAssign (target, ...sources) {\r\n  const copies = sources.map(source => copyObject(source))\r\n  return Object.assign(target, ...copies)\r\n}\r\n\r\nmodule.exports = deepAssign\r\n","const checkJSEnabled = require('./check-js-enabled.js')\nconst headerSelector = 'h1, h2, h3, h4, h5, h6'\n\nfunction fetchReleaseHeader () {\n  const hs = document.querySelectorAll('.release-title')\n  if (!hs) {\n    return []\n  }\n  return Array.from(hs).map(h => {\n    const { href: link } = h.querySelector('a')\n    // all level is 1\n    const tag = 'lv1'\n    const text = h.textContent.trim()\n    return {\n      link,\n      tag,\n      text\n    }\n  })\n}\n\nasync function fetchMarkdownHeader () {\n  const readme = document.querySelector('.markdown-body')\n  if (!readme) {\n    return []\n  }\n  const hs = readme.querySelectorAll(headerSelector)\n  return await getHeaderDataFromMarkdownDOM(hs)\n}\n\nasync function fetchWikiHeader () {\n  const markdown = document.querySelector('.wiki-body .markdown-body')\n  if (!markdown) {\n    return []\n  }\n  let hs = markdown.querySelectorAll(headerSelector)\n  hs = Array.from(hs).filter(h => {\n    return Boolean(h.textContent.trim())\n  })\n  return await getHeaderDataFromMarkdownDOM(hs)\n}\n\nasync function getHeaderDataFromMarkdownDOM (nodelist) {\n  const isJSEnabled = await checkJSEnabled()\n  const arr = Array.isArray(nodelist) ? nodelist : Array.from(nodelist)\n  return arr.map(h => {\n    let { id, href } = h.querySelector('.anchor')\n    id = `#${id}`\n    href = new URL(href).hash\n    const link = isJSEnabled ? href : id\n    const tag = h.tagName.replace('H', 'lv')\n    const text = h.textContent.trim()\n    return {\n      link,\n      tag,\n      text\n    }\n  })\n}\n\nmodule.exports = {\n  fetchReleaseHeader,\n  fetchMarkdownHeader,\n  fetchWikiHeader\n}\n","'use strict'\r\n\r\nconst App = require('./app.html')\r\nconst EventEmitter = require('tiny-emitter')\r\nconst AppAction = require('./action.js')\r\nconst AppStore = require('./store.js')\r\n\r\nconst dispatcher = new EventEmitter()\r\nconst action = new AppAction(dispatcher)\r\nconst store = new AppStore(dispatcher)\r\nconst dataAttr = 'githubMarkdownTocOpen'\r\nconst body = document.body\r\n\r\nconst rootElm = document.createElement('github-markdown-toc-container')\r\nconst $app = new App({\r\n  data: store.getState(),\r\n  target: rootElm\r\n})\r\nbody.appendChild(rootElm)\r\nstore.onChange(() => {\r\n  $app.set(store.getState())\r\n})\r\nstore.onChange(() => {\r\n  const { isOpen } = store.getState()\r\n  if (isOpen) {\r\n    body.dataset[dataAttr] = ''\r\n  } else {\r\n    delete body.dataset[dataAttr]\r\n  }\r\n})\r\n$app.on('toggle-nav', action.toggleNav.bind(action))\r\nwindow.addEventListener('pjax:start', action.startLoading.bind(action))\r\nwindow.addEventListener('pjax:end', action.moveToPage.bind(action))\r\n// init\r\naction.moveToPage()\r\n","const EventEmitter = require('tiny-emitter')\nconst deepAssign = require('./deep-asign.js')\nconst key = require('./action-type.js')\nconst ON_CHANGE = Symbol('on-change')\n\nclass AppStore extends EventEmitter {\n  constructor (dispatcher) {\n    super()\n    this.dispatcher = dispatcher\n    this.state = {\n      isLoading: false,\n      isOpen: false,\n      isEnabled: false,\n      headers: []\n    }\n    this.dispatcher.on(key.START_LOADING, this.loading.bind(this))\n    this.dispatcher.on(key.MOVE_TO_PAGE, this.toPage.bind(this))\n    this.dispatcher.on(key.TOGGLE_NAV, this.toggleNav.bind(this))\n  }\n  loading () {\n    this.setState({\n      isLoading: true\n    })\n  }\n  toPage ({ isAvailable, headers }) {\n    this.setState({\n      headers,\n      isLoading: false,\n      isEnabled: isAvailable,\n      isOpen: isAvailable ? this.state.isOpen : false\n    })\n  }\n  toggleNav () {\n    this.setState({\n      isOpen: !this.state.isOpen\n    })\n  }\n  setState (data) {\n    this.state = deepAssign({}, this.state, data)\n    this.emit(ON_CHANGE)\n  }\n  onChange (func) {\n    this.on(ON_CHANGE, func)\n  }\n  getState () {\n    return deepAssign({}, this.state)\n  }\n}\n\nmodule.exports = AppStore\n"]}